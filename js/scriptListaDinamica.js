let products = {
  data: [
    {
      productName: "Smart Watch SIM A1",
      category: "tecnología",
      price: "46900",
      image: "/assets/assets lista dinamica/Smart-Watch-SIM.jpg",

    },
    {
      productName: "Mini Teclado Inalámbrico",
      category: "tecnología",
      price: "19200",
      image: "/assets/assets lista dinamica/mini-teclado.jpg",

    },
    {
      productName: "Consola Super Nintendo ",
      category: "tecnología",
      price: "100000",
      image: "/assets/assets lista dinamica/consola-videojuegos.jpg",

    },
    {
      productName: "Controlador Electrónico",
      category: "tecnología",
      price: "15600",
      image: "/assets/assets lista dinamica/controlador-electrico.jpg",

    },
    {
      productName: "DRONE 4K HD",
      category: "tecnología",
      price: "90900",
      image: "/assets/assets lista dinamica/dron.jpg",

    },
    {
      productName: "LUCES LED ",
      category: "tecnología",
      price: "46900",
      image: "/assets/assets lista dinamica/luces-led.jpg",

    },
    {
      productName: "Depiladora Electrica",
      category: "mujeres",
      price: "70000",
      image: "/assets/assets lista dinamica/Depiladora.jpg",
    },
    {
      productName: "Mini Plancha De Pelo",
      category: "mujeres",
      price: "90000",
      image: "/assets/assets lista dinamica/Mini-Plancha.jpg",
    },
    {
      productName: "Combo Onikuma (Teclado, Mouse, Diadema)",
      category: "mujeres",
      price: "130000",
      image: "/assets/assets lista dinamica/como-onikuma.jpg",
    },
    {
      productName: "Termo Inteligente Digital",
      category: "mujeres",
      price: "50000",
      image: "/assets/assets lista dinamica/termodigital.jpg",
    },
    {
      productName: "lIGE SMARTH WATCH WOMAN",
      category: "mujeres",
      price: "85000",
      image: "/assets/assets lista dinamica/relooj.jpg",
    },
    {
      productName: "Lámpara Para Uñas",
      category: "mujeres",
      price: "60000",
      image: "/assets/assets lista dinamica/lamaparauñas.jpg",
    },
    {
      productName: "Consola De Mano 8GB",
      category: "hombres",
      price: "330000 ",
      image: "/assets/assets lista dinamica/consola-mano.jpg",
    },

    {
      productName: "Afeitadora Eléctrica ",
      category: "hombres",
      price: "56000 ",
      image: "/assets/assets lista dinamica/Afeitadora.jpg",
    },
    {
      productName: " Gaming Mouse ",
      category: "hombres",
      price: "70000 ",
      image: "/assets/assets lista dinamica/gaming-Mouse.jpg",
    },
    {
      productName: "Auriculares Inalámbricos Business ",
      category: "hombres",
      price: "40000 ",
      image: "/assets/assets lista dinamica/audifonos-man.jpg",
    },
    {
      productName: "Go pro 4k 1080p HD",
      category: "hombres",
      price: "106000 ",
      image: "/assets/assets lista dinamica/gp-pro.jpg",
    },
    {
      productName: "SILLA GAMER",
      category: "hombres",
      price: "230000 ",
      image: "/assets/assets lista dinamica/silla-gamer.jpg",
    },
    {
      productName: "Vaporizador Facial",
      category: "belleza",
      price: "186900",
      image: "/assets/assets lista dinamica/vaporizador-facial.jpg",
    },
    {
      productName: "Cepillo Electronico",
      category: "belleza",
      price: "86900",
      image: "/assets/assets lista dinamica/bcepillo.jpg",
    },
    {
      productName: "Depilacion Laser",
      category: "belleza",
      price: "109900",
      image: "/assets/assets lista dinamica/bdepilacion.jpg",
    },
    {
      productName: "Mascarilla Facial LED",
      category: "belleza",
      price: "45900",
      image: "/assets/assets lista dinamica/bmascarilla.jpg",
    },
    {
      productName: "SECADORA DE PELO",
      category: "belleza",
      price: "186900",
      image: "/assets/assets lista dinamica/bsecadora.jpg",
    },
    {
      productName: "Masajeador Muscular",
      category: "belleza",
      price: "306900",
      image: "/assets/assets lista dinamica/masajeador.jpg",
    },
    {
      productName: "Balon Inteligente XIAOMI",
      category: "deporte",
      price: "900000",
      image: "/assets/assets lista dinamica/balon.jpg",
    },
    {
      productName: "Auriculares Inalámbricos",
      category: "deporte",
      price: "89000",
      image: "/assets/assets lista dinamica/auriculares-bluetooth.jpg",
    },
    {
      productName: "Gafas Deportivas VR",
      category: "deporte",
      price: "209000",
      image: "/assets/assets lista dinamica/gafas3d.jpg",
    },
    {
      productName: "Zapatillas Inteligentes Adidas",
      category: "deporte",
      price: "500000",
      image: "/assets/assets lista dinamica/zapatillas.jpg",
    },
    {
      productName: "Masajeador  Muscular",
      category: "salud",
      price: "300000",
      image: "/assets/assets lista dinamica/masajeador.jpg",
    },
    {
      productName: "Sensor De Higrómetro Digital",
      category: "salud",
      price: "300000",
      image: "/assets/assets lista dinamica/termometro.jpg",
    },
    {
      productName: "Monitor De Presión Arterial",
      category: "salud",
      price: "74000",
      image: "/assets/assets lista dinamica/monitor.jpg",
    },
    {
      productName: "Masajeador De Pies Eléctrico",
      category: "salud",
      price: "39000",
      image: "/assets/assets lista dinamica/masajeadorpies.jpg",
    },
    {
      productName: "Termómetro Infrarrojo ",
      category: "salud",
      price: "300000",
      image: "/assets/assets lista dinamica/termometrodigital.jpg",
    },

    {
      productName: "Proyector De Estrellas",
      category: "hogar",
      price: "189000",
      image: "/assets/assets lista dinamica/proyector-estrellas.jpg",
    },
    {
      productName: "Freidora De Aire",
      category: "hogar",
      price: "189000",
      image: "/assets/assets lista dinamica/airflayer.jpg",
    },
    {
      productName: "Alexa Google Home",
      category: "hogar",
      price: "100000",
      image: "/assets/assets lista dinamica/alexa.jpg",
    },
    {
      productName: "Difusor De Llama THREEFLAMES",
      category: "hogar",
      price: "189000",
      image: "/assets/assets lista dinamica/difusor.jpg",
    },
    {
      productName: "Cortina Cadena De Luces",
      category: "hogar",
      price: "48000",
      image: "/assets/assets lista dinamica/ledhadas.jpg",
    },
    {
      productName: "Rosa Eterna 24K",
      category: "hogar",
      price: "33000",
      image: "/assets/assets lista dinamica/rosaeterna.jpg",
    },
    {
      productName: "Mini Cámara Inalámbrica",
      category: "descuentos",
      price: "163000",
      image: "/assets/assets lista dinamica/mini-camara.jpg",
    },
    {
      productName: "Fujifilm Instax Mini ",
      category: "descuentos",
      price: "656000",
      image: "/assets/assets lista dinamica/camarita.jpg",
    },
    {
      productName: "Gafas De Sol Compatibles Con Bluetooth ",
      category: "descuentos",
      price: "30000",
      image: "/assets/assets lista dinamica/gafassol.jpg",
    },




  ],
};

for (let i of products.data) {
  // Crear la tarjeta
  let card = document.createElement("div");
  // La tarjeta debe tener una clase de categoría y debe permanecer oculta inicialmente
  card.classList.add("card", i.category, "hide");

  // Contenedor de imagen
  let imgContainer = document.createElement("div");
  imgContainer.classList.add("image-container");

  // Etiqueta de imagen
  let image = document.createElement("img");
  image.setAttribute("src", i.image);
  image.classList.add("imageLista");
  imgContainer.appendChild(image);
  card.appendChild(imgContainer);

  // Contenedor
  let container = document.createElement("div");
  container.classList.add("container");

  // Nombre del producto
  let name = document.createElement("h5");
  name.classList.add("product-name");
  name.innerText = i.productName.toUpperCase();
  container.appendChild(name);

  // Precio
  let price = document.createElement("h6");
  const precioFormateado = new Intl.NumberFormat('es-ES').format(i.price);
  price.innerText = `$${precioFormateado}`;

  container.appendChild(price);

  // Botón "Añadir al carrito" con icono de carrito
  let addButton = document.createElement("button");
  addButton.classList.add("add-to-cart-button");
  addButton.innerHTML = '<i class="fas fa-shopping-cart"></i> Añadir al carrito';
  addButton.addEventListener("click", function() {
    // Función para manejar el evento de clic del botón
    addToCart(i); // Aquí deberías pasar el ID del producto
  });
  container.appendChild(addButton);

  card.appendChild(container);
  document.getElementById("products").appendChild(card);
}

function addToCart(product) {
  const cart = getCart();
  const existingItemIndex = cart.findIndex(item => item.productName === product.productName);

  if (existingItemIndex !== -1) {
    // Si el producto ya está en el carrito, aumenta la cantidad en 1
    cart[existingItemIndex].quantity += 1;

    Swal.fire({
      position: "top-end",
      icon: "info",
      title: "Se agregó una unidad al carrito",
      showConfirmButton: false,
      timer: 1500
    });
  } else {
    // Si el producto no está en el carrito, agrégalo con cantidad 1
    const newItem = {
      image: product.image,
      productName: product.productName,
      category: product.category,
      price: product.price,
      quantity: 1,
    };
    cart.push(newItem);

    Swal.fire({
      position: "top-end",
      icon: "success",
      title: "El producto se añadió correctamente al carrito",
      showConfirmButton: false,
      timer: 1500
    });
  }

  // Actualiza el carrito en el almacenamiento local y renderiza el carrito
  updateCart(cart);
  renderCart();
}

//parameter passed from button (Parameter same as category)
function filterProduct(value) {
  //Button class code
  let buttons = document.querySelectorAll(".button-value");
  buttons.forEach((button) => {
    //check if value equals innerText
    if (value.toUpperCase() == button.innerText.toUpperCase()) {
      button.classList.add("active");
    } else {
      button.classList.remove("active");
    }
  });

  //select all cards
  let elements = document.querySelectorAll(".card");
  //loop through all cards
  elements.forEach((element) => {
    //display all cards on 'all' button click
    if (value == "todo") {
      element.classList.remove("hide");
    } else {
      //Check if element contains category class
      if (element.classList.contains(value)) {
        //display element based on category
        element.classList.remove("hide");
      } else {
        //hide other elements
        element.classList.add("hide");
      }
    }
  });
}

//Search button click
document.getElementById("buscar").addEventListener("click", () => {
  //initializations
  let searchInput = document.getElementById("buscar-input").value;
  let elements = document.querySelectorAll(".product-name");
  let cards = document.querySelectorAll(".card");

  //loop through all elements
  elements.forEach((element, index) => {
    //check if text includes the search value
    if (element.innerText.includes(searchInput.toUpperCase())) {
      //display matching card
      cards[index].classList.remove("hide");
    } else {
      //hide others
      cards[index].classList.add("hide");
    }
  });
});

//Initially display all products
window.onload = () => {
  filterProduct("todo");
};

function renderizarProductos() {
  baseDeDatos.forEach((info) => {
    // Crear la estructura de la tarjeta del producto
    const miNodo = document.createElement("div");
    miNodo.classList.add("card", "col-sm-4");

    // Crear el cuerpo de la tarjeta
    const miNodoCardBody = document.createElement("div");
    miNodoCardBody.classList.add("card-body");

    // Crear el título del producto
    const miNodoTitle = document.createElement("h5");
    miNodoTitle.classList.add("card-title");
    miNodoTitle.textContent = info.nombre;

    // Crear la imagen del producto
    const miNodoImagen = document.createElement("img");
    miNodoImagen.classList.add("img-fluid");
    miNodoImagen.setAttribute("src", info.imagen);

    // Crear el precio del producto
    const miNodoPrecio = document.createElement("p");
    miNodoPrecio.classList.add("card-text");
    miNodoPrecio.textContent = `${info.precio}${divisa}`;

    // Crear el botón "Añadir al carrito" con un ícono
    const miNodoBoton = document.createElement("button");
    miNodoBoton.classList.add("btn", "btn-primary");
    miNodoBoton.textContent = "Añadir al carrito";

    const miNodoIcono = document.createElement("i");
    miNodoIcono.classList.add("fas", "fa-cart-plus");
    miNodoBoton.appendChild(miNodoIcono);

    // Agregar el evento click al botón
    miNodoBoton.addEventListener("click", () => {
      anyadirProductoAlCarrito(info.id);
    });

    // Agregar elementos al cuerpo de la tarjeta
    miNodoCardBody.appendChild(miNodoImagen);
    miNodoCardBody.appendChild(miNodoTitle);
    miNodoCardBody.appendChild(miNodoPrecio);
    miNodoCardBody.appendChild(miNodoBoton);

    // Agregar el cuerpo de la tarjeta al nodo del producto
    miNodo.appendChild(miNodoCardBody);

    // Agregar el nodo del producto al DOM
    DOMitems.appendChild(miNodo);
  });
}

// Función para mostrar productos en una página específica
// function renderProducts(page) {
//   const startIndex = (page - 1) * productsPerPage; 
//   const endIndex = startIndex + productsPerPage;
//   const currentProducts = products.data.slice(startIndex, endIndex);
//   console.log(currentProducts);
//   document.getElementById("products").innerHTML = "";

//   currentProducts.forEach((i) => {
//     let card = document.createElement("div");
//     card.classList.add("card", i.category, "hide");
//     let imgContainer = document.createElement("div");
//     imgContainer.classList.add("image-container");

//     let image = document.createElement("img");
//     image.setAttribute("src", i.image);
//     image.classList.add("imageLista");
//     imgContainer.appendChild(image);
//     card.appendChild(imgContainer);

//     let container = document.createElement("div");
//     container.classList.add("container");

//     let name = document.createElement("h5");
//     name.classList.add("product-name");
//     name.innerText = i.productName.toUpperCase();
//     container.appendChild(name);

//     let price = document.createElement("h6");
//     const precioFormateado = new Intl.NumberFormat('es-ES').format(i.price);
//     price.innerText = `$${precioFormateado}`;

//     container.appendChild(price);

//     let addButton = document.createElement("button");
//     addButton.classList.add("add-to-cart-button");
//     addButton.innerHTML = '<i class="fas fa-shopping-cart"></i> Añadir al carrito';
//     addButton.addEventListener("click", function () {
//       addToCart(i);
//     });
//     container.appendChild(addButton);

//     card.appendChild(container);
//     document.getElementById("products").appendChild(card);
//     
//   });
// }

// Llamar a la función para renderizar los productos en la página inicial
renderProducts(currentPage);
// Llamar a la función para actualizar la paginación
updatePagination();
